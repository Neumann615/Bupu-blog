# 热门面试题

## js的事件循环机制

JavaScript 的事件循环（Event Loop）机制是其异步编程模型的核心，它使得单线程的JavaScript能够处理并发操作，如定时器、网络请求、用户交互等，而不会阻塞主线程。事件循环主要基于以下几个关键概念：

1. 调用栈（Call Stack）: JavaScript
   的执行是基于调用栈的，它记录了当前执行的所有函数的执行顺序。每当一个函数被调用，它就会被添加到调用栈的顶部；当函数执行完毕，它就会从栈顶被移除。JavaScript总是执行调用栈顶部的函数。

2. 消息队列（Message Queue / Task Queue）:
   所有异步操作（如setTimeout、Promise、fetch等）完成后要执行的回调函数会被放入消息队列。这是一个先进先出（FIFO）的数据结构，等待被事件循环处理。

3. 事件循环:

- 当调用栈为空时，事件循环会从消息队列中取出下一个任务（回调函数）并将其推入调用栈执行。
- 如果此时消息队列为空，事件循环会等待直到有新的任务进入队列。
- 这个过程不断重复，即不断地检查调用栈是否为空，消息队列中是否有待处理的任务，形成了一个循环，这就是事件循环的基本机制。
- 宏任务（Macrotask）与微任务（Microtask）:

宏任务包括：script代码块、setTimeout、setInterval、I/O、UI rendering等。
微任务包括：Promise的回调（.then/.catch/.finally）、MutationObserver、process.nextTick（Node.js特有）等。
每次执行完当前宏任务后，会清空所有的微任务队列，然后再开始执行下一个宏任务。这意味着微任务总是在当前宏任务结束后，下一个宏任务开始前执行，且微任务之间也是按照先进先出的顺序执行。
总结起来，JavaScript的事件循环机制保证了即使在单线程环境下也能有效处理并发操作，通过分时执行不同的任务，既保证了用户体验（如页面不会因为某个操作长时间阻塞而无响应），又充分利用了CPU的空闲时间。

## 在浏览器中输入链接按下回车到网页显示的过程

1. **解析URL**：浏览器首先解析你输入的URL，确定要访问的服务器地址、路径、协议类型等信息。

2. **DNS查询**：浏览器通过DNS（域名系统）将网站的域名转换为IP地址。这个过程可能涉及本地缓存、路由器缓存、ISP DNS服务器乃至根域名服务器的查询。

3. **建立TCP连接**：获取到IP地址后，浏览器使用TCP协议与服务器建立连接。这通常涉及三次握手过程，确保双方都能发送和接收数据。

4. **发送HTTP/HTTPS请求**
   ：建立连接后，浏览器构造一个HTTP或HTTPS请求报文，包括请求行（方法、URL、协议版本）、请求头（如User-Agent、Accept-Language）以及可能的请求体（POST请求时），然后发送给服务器。

5. **服务器处理请求**：服务器接收到请求后，根据请求内容进行处理。这可能包括执行服务器端脚本（如PHP、Node.js）、查询数据库、生成动态内容等。

6. **服务器返回响应**：服务器完成处理后，构造一个HTTP响应报文，包括状态码（如200 OK表示成功）、响应头（如Content-Type指示内容类型）以及响应体（即实际的网页内容），并通过TCP连接发送给浏览器。

7. **下载资源**
   ：浏览器接收到HTML响应后，开始解析HTML文档，构建DOM树。在解析过程中，遇到CSS、JavaScript文件、图片等外部资源时，浏览器会根据需要发送额外的请求去获取这些资源。这一步也可能涉及DNS查询、TCP连接和HTTP请求。

8. **渲染页面**：

- 构建CSSOM：浏览器解析CSS文件，构建CSSOM（CSS对象模型）。
- 渲染树构建：结合DOM树和CSSOM，构建渲染树，该树只包含需要渲染的元素及其样式。
- 布局：根据渲染树计算每个节点的几何位置，即布局或回流过程。
- 绘制：遍历渲染树并使用UI后端层将节点绘制到屏幕上。

9. **执行JavaScript**：在页面加载过程中或页面加载完成后，浏览器会解析并执行JavaScript代码。这可能会影响DOM结构、CSSOM或触发额外的网络请求，导致重新布局或绘制。

10. **交互与后续请求**：页面完全加载后，用户可以与页面交互。交互过程中，可能触发额外的AJAX请求、WebSocket通信等，进一步更新页面内容。